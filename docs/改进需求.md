1. 插件设定页面，作如下改动
   1. system prompt应该有独立的子窗口进行编辑（更大的文本编辑框）
   2. 实现manage tools功能（现在未实现）
   3. 文件夹配置应该参考Obsidian官方设置，点击之后出现下拉菜单，可以快速选择已有文件夹，或快速创建文件夹。（见参考图）
2. 在右边栏（聊天窗口），补足如下功能
   1. 参考图中的样式，对聊天窗口进行美化。
   2. 所有内容可选中复制
   3. 再对话输入框中，可以快速选择模型，可以快速切换thinking/非thinking模式
   4. 有生成和停止生成按钮（动态变化）
   5. 用cmd/ctrl+enter来发送消息
   6. 生成的回复下方应该有“复制、复制到文档、日志、重新生成”功能的按钮，并且也需要实现对应功能
   7. 用户query应该单独有一行，并且最近的query应该有编辑功能。点击编辑之后，可以修改query内容（包括引用文档），然后有重新发送的功能（快捷键也是cmd/ctrl+enter）
   8. 创建/修改的文件有预览功能，并可可以快速定位到文件/文件指定位置（在文本编辑器中打开）
   9. 可以支持多个聊天session，每个session的对话历史相互独立。
3.  右边栏美化以及bug
    1.  使用扁平风格，所有UI要素使用圆角，可以用图标代替的UI组件不要用文字。
    2.  ctrl+回车没有正确发送
    3.  压缩call tool消息占据的空间（可以默认堆叠）
    4.  减小整体字体（可以在菜单中配置）
4.  右边栏功能
    1.  可以命名对话session（双击tab之后变成可编辑模式，编辑后回车确认session名）
    2.  若session未命名，但已经有query，则以session第一个query的前N个字命名
    3.  使用更简约的标准化UI图标而非emoji
    4.  ctrl+enter还是没有正确发出消息
    5.  编辑文档的tool调用需要展示对应文档的缩略图，其他连续的工具调用折叠在一起（不要逐个展示，很占地方）
5.  右边栏
    1.  按@或#打开引用、工具列表之后，应该可以通过上下键在多个文档、工具中导航，并通过回车键选中对应的文档、工具。
    2.  在输入框中的任何位置按@都应该能打开文档引用功能，#同理。
    3.  对话历史应该保存，下次打开插件时应该显示之前的内容。
6.  局部编辑功能：
    1.  在编辑器中，选中文本并点击add to voyaru context之后，并没有实际生效。预期效果应该是将文件以及行数区间送给模型，以便模型修改
    2.  在编辑器中，选中文本之后，右键菜单中应该出现“局部修改”按钮。点击之后，弹出子窗口，让用户输入query，并调用Agent，根据要求对局部进行修改，同时保持和上下文的连贯性。（需要在system prompt中拼入额外的内容）
    3.  局部修改的过程中，应该有一个持续存在的UI（比如一个小巧的浮窗），以便用户感知到正在修改。另外，增加一个终止局部修改的功能。
    4.  修改query并重新生成时，应该先撤回对应query的修改（包含文档修改），然后再重新生成回复。
7.  


1. 保存状态
   1. 插件设置中的所有配置应该自动保存，重新载入插件、重启obsidian都不应该丢失已有配置
   2. 对话历史（每个session）都应该自动保存，重新载入插件、重启obsidian不应该丢失已有聊天内容。
   3. query并没有被正确发送，确定哪里出了问题。
   4. 工具的创建、修改并没有被正常保存
   5. obsidian编辑器载入文件的速度变慢了，并且点击文件之后不能正确读取文件内容。修复这个问题。
2. 局部修改
3. 发送query之后，应该把query移动至聊天窗口的顶部