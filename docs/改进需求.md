1. 插件设定页面，作如下改动
   1. system prompt应该有独立的子窗口进行编辑（更大的文本编辑框）
   2. 实现manage tools功能（现在未实现）
   3. 文件夹配置应该参考Obsidian官方设置，点击之后出现下拉菜单，可以快速选择已有文件夹，或快速创建文件夹。（见参考图）
2. 在右边栏（聊天窗口），补足如下功能
   1. 参考图中的样式，对聊天窗口进行美化。
   2. 所有内容可选中复制
   3. 再对话输入框中，可以快速选择模型，可以快速切换thinking/非thinking模式
   4. 有生成和停止生成按钮（动态变化）
   5. 用cmd/ctrl+enter来发送消息
   6. 生成的回复下方应该有“复制、复制到文档、日志、重新生成”功能的按钮，并且也需要实现对应功能
   7. 用户query应该单独有一行，并且最近的query应该有编辑功能。点击编辑之后，可以修改query内容（包括引用文档），然后有重新发送的功能（快捷键也是cmd/ctrl+enter）
   8. 创建/修改的文件有预览功能，并可可以快速定位到文件/文件指定位置（在文本编辑器中打开）
   9. 可以支持多个聊天session，每个session的对话历史相互独立。
3.  右边栏美化以及bug
    1.  使用扁平风格，所有UI要素使用圆角，可以用图标代替的UI组件不要用文字。
    2.  ctrl+回车没有正确发送
    3.  压缩call tool消息占据的空间（可以默认堆叠）
    4.  减小整体字体（可以在菜单中配置）
4.  右边栏功能
    1.  可以命名对话session（双击tab之后变成可编辑模式，编辑后回车确认session名）
    2.  若session未命名，但已经有query，则以session第一个query的前N个字命名
    3.  使用更简约的标准化UI图标而非emoji
    4.  ctrl+enter还是没有正确发出消息
    5.  编辑文档的tool调用需要展示对应文档的缩略图，其他连续的工具调用折叠在一起（不要逐个展示，很占地方）
5.  右边栏
    1.  按@或#打开引用、工具列表之后，应该可以通过上下键在多个文档、工具中导航，并通过回车键选中对应的文档、工具。
    2.  在输入框中的任何位置按@都应该能打开文档引用功能，#同理。
    3.  对话历史应该保存，下次打开插件时应该显示之前的内容。
6.  局部编辑功能：
    1.  在编辑器中，选中文本并点击add to voyaru context之后，并没有实际生效。预期效果应该是将文件以及行数区间送给模型，以便模型修改
    2.  在编辑器中，选中文本之后，右键菜单中应该出现“局部修改”按钮。点击之后，弹出子窗口，让用户输入query，并调用Agent，根据要求对局部进行修改，同时保持和上下文的连贯性。（需要在system prompt中拼入额外的内容）
    3.  局部修改的过程中，应该有一个持续存在的UI（比如一个小巧的浮窗），以便用户感知到正在修改。另外，增加一个终止局部修改的功能。
    4.  修改query并重新生成时，应该先撤回对应query的修改（包含文档修改），然后再重新生成回复。
7.  


1. 保存状态
   1. 插件设置中的所有配置应该自动保存，重新载入插件、重启obsidian都不应该丢失已有配置
   2. 对话历史（每个session）都应该自动保存，重新载入插件、重启obsidian不应该丢失已有聊天内容。
   3. query并没有被正确发送，确定哪里出了问题。
   4. 工具的创建、修改并没有被正常保存
   5. obsidian编辑器载入文件的速度变慢了，并且点击文件之后不能正确读取文件内容。修复这个问题。
2. 局部修改
3. 发送query之后，应该把query移动至聊天窗口的顶部
4. UI优化（参考图片）
   1. 编辑文档的tool调用需要展示对应文档的缩略图（点击可以直接打开文件，有字数显示），其他连续的工具调用折叠在一起（不要逐个展示，很占地方）
   2. 生成的回复下方应该有“复制、复制到文档、日志、重新生成”功能的按钮，并且也需要实现对应功能
   3. 增加一键清空聊天历史的功能（被清除的内容不应发送给LLM，需要确认）
   4. 用扁平风格，所有UI要素使用圆角
   5. 增加快速调整侧边栏中文字大小的功能
   6. UI元素整体较大，应该缩小，以体现高级感
5. UI优化
   1. 在输入框中，应该可以快速选择模型。
   2. 在生成过程中，随时可以点击停止按钮（也就是原来的发送按钮）停止生成（现在无法点击）
   3. 现在生成的回复还没有“重新生成功能”，也没有“查看日志功能”（查看日志应该弹出一个子窗口，显示模型的所有回复，无论是回复内容还是报错，应该是json格式）
   4. 复制到文档，应该弹出子窗口，让用户选择是覆盖已有文件，还是append到已有文件的末尾，还是append到新建文件。
   5. 发出的query中应该显示所有引用的文件（包括段落）
   6. 最后一条发出的query应该可以修改并重新发送（发送时撤销所有原query导致的回复和文件改动）
   7. 优化agent的图标
6. 复制到文档功能的子窗口，应该让用户选择任意文档，而不是默只能选择当前文档或新建文档。
7. 发送消息之后，应该立即通过下拉聊天窗口来使得发送的消息在最顶端。在生成过程中，应该实时下拉聊天窗口，以完整显示最新生成的内容。
8. 实现query的重新生成功能
   1. 触发方式：1）编辑用户的query（只支持最近1条）并重新发送（无论是否有改动）；2）点击回复下面的 重新生成按钮
   2. 步骤：1）撤销该回复的所有改动（包括文件改动，因此你需要track最近一次回复对文件的所有修改）；2）清楚所有回复内容；3）重新生成回复内容（相当于第一次见到这个query）
9. session管理优化
   1.  将新建session的UI按钮修改为扁平风格
   2.  新增的session应该出现在最右方（现在是最左方）。
   3.  如果删除唯一一个session，应该立即新建一个新的session，并完成删除
   4.  字体大小设置应该和插件配置一样，实时保存

我需要在聊天窗口实现一个类似“通讯录分组标题”的吸顶交互效果。 场景是 QA 问答列表：
   - 将每一组 QA（提问+回答）看作一个独立的 Section 或 Container。
   - “提问（Query）”作为这个 Section 的 Header。
   - 当我滚动浏览“回答（Answer）”时（包含这个回答的所有内容，如工具调用，文件预览等），“query”要一直**吸附（Stick）**在屏幕/容器的最顶端。直到这组 QA 完全滚出屏幕，或者被下一组 QA 的“提问”顶替位置。
   - 请使用 position: sticky 来实现，并确保“提问”部分有背景色，防止文字重叠。

在修改query时：
1. 应该原地修改（将query变成一个文本编辑窗，并且有取消、发送按钮，enter键同样可以发送）
2. 点击原query外的地方，取消编辑
3. 只有在确定发送之后，才进行重新生成流程（包括撤销之前的修改）

对话框有两个问题：
1. 发送query时，对话历史应该以聊天框中当前的信息为准（任何被删除的消息、被覆盖的消息，都不能出现在对话历史中，以免模型的输出和用户预期不符）
2. 现在query可以吸附在顶端，但是因为query的UI要素在上方、左右存在透明部分，在滚动时，answer会出现在透明部分，十分怪异。你应该重新设计query-answer的UI，解决这个问题（你可以参考cursor，用一个完整的框体来表现query）

现在模型的输出默认会被滚动出聊天窗口（向上滚动，超过query），这是一个严重的问题，你可能误解了我之前提出的需求。展示query的原则应该是：尽可能多地展示answer：
1. 除非answer的长度超出了聊天窗口，否则不向上滚动answer，以显示尽可能多的answer；
2. 如果长度超出了聊天窗口，滚动到聊天窗口足以展示query的尾部（四个按钮），就不能再往上滚动（违背了尽可能展示完整answer的原则）；
3. 如果长度不够填充聊天窗口，则在query尾部和聊天窗口底部之间填入一段空白，以保证来回滚动时，可以将query滚动到聊天窗口顶部。